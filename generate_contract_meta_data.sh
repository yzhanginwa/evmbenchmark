#!/bin/bash

# The compiled contracts of each module are saved in directory "contract/{module_name}"
# The module_name will be used as the go package name
for dir in contracts/build/*/; do
    package=$(basename ${dir})
    destdir=lib/contract_meta_data/${package}
    mkdir -p ${destdir}
    destfile=${destdir}/meta_data.go

    echo // This file is generated by \"make metadata\", please do not edit it > ${destfile}
    echo  >> ${destfile}
    echo package ${package} >> ${destfile}
    echo >> ${destfile}

    for file in ${dir}*.abi; do
        filename=$(basename ${file})
        variable=${filename%.*}ABI
        echo var ${variable} = \"$(cat ${file}|sed 's/"/\\"/g')\" >> ${destfile}
    done

    echo >> ${destfile}

    for file in ${dir}*.bin; do
        filename=$(basename ${file})
        variable="${filename%.*}Bin"
        echo var ${variable} = \"$(cat ${file})\" >> ${destfile}
    done
done
